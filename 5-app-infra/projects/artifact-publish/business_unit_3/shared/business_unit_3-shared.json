{"format_version":"1.2","terraform_version":"1.8.5-dev","variables":{"instance_region":{"value":"us-central1"},"remote_state_bucket":{"value":"bkt-prj-b-seed-7c57-gcp-projects-tfstate"}},"planned_values":{"outputs":{"cloudbuild_trigger_id":{"sensitive":false,"type":"string","value":"projects/prj-c-bu3artifacts-mj6b/locations/us-central1/triggers/7922aa56-a59f-45b8-b739-1fc45980f0e6"}},"root_module":{"child_modules":[{"resources":[{"address":"module.artifact_publish.google_artifact_registry_repository.repo","mode":"managed","type":"google_artifact_registry_repository","name":"repo","provider_name":"registry.terraform.io/hashicorp/google-beta","schema_version":0,"values":{"cleanup_policies":[{"action":"KEEP","condition":[{"newer_than":"","older_than":"","package_name_prefixes":["webapp","mobile"],"tag_prefixes":["release"],"tag_state":"TAGGED","version_name_prefixes":[]}],"id":"keep-tagged-release","most_recent_versions":[]}],"cleanup_policy_dry_run":false,"create_time":"2024-05-24T11:41:39.113004Z","description":"Publish Artifacts for ML Projects","docker_config":[],"effective_labels":{},"format":"DOCKER","id":"projects/prj-c-bu3artifacts-mj6b/locations/us-central1/repositories/c-publish-artifacts","kms_key_name":"projects/prj-c-kms-exfv/locations/us-central1/keyRings/sample-keyring/cryptoKeys/prj-c-bu3artifacts","labels":{},"location":"us-central1","maven_config":[],"mode":"STANDARD_REPOSITORY","name":"c-publish-artifacts","project":"prj-c-bu3artifacts-mj6b","remote_repository_config":[],"repository_id":"c-publish-artifacts","terraform_labels":{},"timeouts":null,"update_time":"2024-05-24T11:41:39.113004Z","virtual_repository_config":[]},"sensitive_values":{"cleanup_policies":[{"condition":[{"package_name_prefixes":[false,false],"tag_prefixes":[false],"version_name_prefixes":[]}],"most_recent_versions":[]}],"docker_config":[],"effective_labels":{},"labels":{},"maven_config":[],"remote_repository_config":[],"terraform_labels":{},"virtual_repository_config":[]}},{"address":"module.artifact_publish.google_artifact_registry_repository_iam_member.project[\"roles/artifactregistry.reader\"]","mode":"managed","type":"google_artifact_registry_repository_iam_member","name":"project","index":"roles/artifactregistry.reader","provider_name":"registry.terraform.io/hashicorp/google","schema_version":0,"values":{"condition":[],"etag":"BwYZMacjH/I=","id":"projects/prj-c-bu3artifacts-mj6b/locations/us-central1/repositories/c-publish-artifacts/roles/artifactregistry.reader/serviceAccount:393452337890@cloudbuild.gserviceaccount.com","location":"us-central1","member":"serviceAccount:393452337890@cloudbuild.gserviceaccount.com","project":"prj-c-bu3artifacts-mj6b","repository":"projects/prj-c-bu3artifacts-mj6b/locations/us-central1/repositories/c-publish-artifacts","role":"roles/artifactregistry.reader"},"sensitive_values":{"condition":[]}},{"address":"module.artifact_publish.google_artifact_registry_repository_iam_member.project[\"roles/artifactregistry.writer\"]","mode":"managed","type":"google_artifact_registry_repository_iam_member","name":"project","index":"roles/artifactregistry.writer","provider_name":"registry.terraform.io/hashicorp/google","schema_version":0,"values":{"condition":[],"etag":"BwYZMacjH/I=","id":"projects/prj-c-bu3artifacts-mj6b/locations/us-central1/repositories/c-publish-artifacts/roles/artifactregistry.writer/serviceAccount:393452337890@cloudbuild.gserviceaccount.com","location":"us-central1","member":"serviceAccount:393452337890@cloudbuild.gserviceaccount.com","project":"prj-c-bu3artifacts-mj6b","repository":"projects/prj-c-bu3artifacts-mj6b/locations/us-central1/repositories/c-publish-artifacts","role":"roles/artifactregistry.writer"},"sensitive_values":{"condition":[]}},{"address":"module.artifact_publish.google_cloudbuild_trigger.docker_build","mode":"managed","type":"google_cloudbuild_trigger","name":"docker_build","provider_name":"registry.terraform.io/hashicorp/google","schema_version":2,"values":{"approval_config":[{"approval_required":false}],"bitbucket_server_trigger_config":[],"build":[{"artifacts":[],"available_secrets":[],"images":[],"logs_bucket":"","options":[],"queue_ttl":"","secret":[],"source":[],"step":[{"allow_exit_codes":[],"allow_failure":false,"args":["-c","git fetch --unshallow"],"dir":"","entrypoint":"/bin/bash","env":[],"id":"unshallow","name":"gcr.io/cloud-builders/git","script":"","secret_env":[],"timeout":"","timing":"","volumes":[],"wait_for":[]},{"allow_exit_codes":[],"allow_failure":false,"args":["-c","changed_files=$(git diff ${COMMIT_SHA}^1 --name-only -r)\nchanged_folders=$(echo \"$changed_files\" | awk -F/ '{print $2}' | sort | uniq )\n\nfor folder in $changed_folders; do\n    echo \"Found docker folder: $folder\"\n    echo $folder \u003e\u003e /workspace/docker_build\ndone\n"],"dir":"","entrypoint":"/bin/bash","env":[],"id":"select-folder","name":"gcr.io/cloud-builders/git","script":"","secret_env":[],"timeout":"","timing":"","volumes":[],"wait_for":[]},{"allow_exit_codes":[],"allow_failure":false,"args":["-c","build_path=\"/workspace/docker_build\"\nwhile IFS= read -r line; do\n  docker build -t us-central1-docker.pkg.dev/$PROJECT_ID/c-publish-artifacts/$line images/$line\ndone \u003c \"$build_path\"\n"],"dir":"","entrypoint":"/bin/bash","env":[],"id":"build-image","name":"gcr.io/cloud-builders/docker","script":"","secret_env":[],"timeout":"","timing":"","volumes":[],"wait_for":["select-folder"]},{"allow_exit_codes":[],"allow_failure":false,"args":["-c","build_path=\"/workspace/docker_build\"\nwhile IFS= read -r line; do\n  docker push us-central1-docker.pkg.dev/$PROJECT_ID/c-publish-artifacts/$line\ndone \u003c \"$build_path\"\n"],"dir":"","entrypoint":"/bin/bash","env":[],"id":"push-image","name":"gcr.io/cloud-builders/docker","script":"","secret_env":[],"timeout":"","timing":"","volumes":[],"wait_for":["select-folder","build-image"]}],"substitutions":{},"tags":[],"timeout":"600s"}],"create_time":"2024-05-24T11:41:19.846856052Z","description":"","disabled":false,"filename":"","filter":"","git_file_source":[],"github":[],"id":"projects/prj-c-bu3artifacts-mj6b/locations/us-central1/triggers/7922aa56-a59f-45b8-b739-1fc45980f0e6","ignored_files":[],"include_build_logs":"","included_files":[],"location":"us-central1","name":"docker-build","project":"prj-c-bu3artifacts-mj6b","pubsub_config":[],"repository_event_config":[],"service_account":"","source_to_build":[],"substitutions":{},"tags":[],"timeouts":null,"trigger_id":"7922aa56-a59f-45b8-b739-1fc45980f0e6","trigger_template":[{"branch_name":"^main$","commit_sha":"","dir":"","invert_regex":false,"project_id":"prj-c-bu3artifacts-mj6b","repo_name":"publish-artifacts","tag_name":""}],"webhook_config":[]},"sensitive_values":{"approval_config":[{}],"bitbucket_server_trigger_config":[],"build":[{"artifacts":[],"available_secrets":[],"images":[],"options":[],"secret":[],"source":[],"step":[{"allow_exit_codes":[],"args":[false,false],"env":[],"secret_env":[],"volumes":[],"wait_for":[]},{"allow_exit_codes":[],"args":[false,false],"env":[],"secret_env":[],"volumes":[],"wait_for":[]},{"allow_exit_codes":[],"args":[false,false],"env":[],"secret_env":[],"volumes":[],"wait_for":[false]},{"allow_exit_codes":[],"args":[false,false],"env":[],"secret_env":[],"volumes":[],"wait_for":[false,false]}],"substitutions":{},"tags":[]}],"git_file_source":[],"github":[],"ignored_files":[],"included_files":[],"pubsub_config":[],"repository_event_config":[],"source_to_build":[],"substitutions":{},"tags":[],"trigger_template":[{}],"webhook_config":[]}},{"address":"module.artifact_publish.google_kms_crypto_key_iam_member.artifact-kms-key-binding","mode":"managed","type":"google_kms_crypto_key_iam_member","name":"artifact-kms-key-binding","provider_name":"registry.terraform.io/hashicorp/google","schema_version":0,"values":{"condition":[],"crypto_key_id":"projects/prj-c-kms-exfv/locations/us-central1/keyRings/sample-keyring/cryptoKeys/prj-c-bu3artifacts","etag":"BwYZMaV6vl4=","id":"projects/prj-c-kms-exfv/locations/us-central1/keyRings/sample-keyring/cryptoKeys/prj-c-bu3artifacts/roles/cloudkms.cryptoKeyEncrypterDecrypter/serviceAccount:service-393452337890@gcp-sa-artifactregistry.iam.gserviceaccount.com","member":"serviceAccount:service-393452337890@gcp-sa-artifactregistry.iam.gserviceaccount.com","role":"roles/cloudkms.cryptoKeyEncrypterDecrypter"},"sensitive_values":{"condition":[]}},{"address":"module.artifact_publish.google_project_service_identity.artifact_registry_agent","mode":"managed","type":"google_project_service_identity","name":"artifact_registry_agent","provider_name":"registry.terraform.io/hashicorp/google-beta","schema_version":0,"values":{"email":"service-393452337890@gcp-sa-artifactregistry.iam.gserviceaccount.com","id":"projects/prj-c-bu3artifacts-mj6b/services/artifactregistry.googleapis.com","project":"prj-c-bu3artifacts-mj6b","service":"artifactregistry.googleapis.com","timeouts":null},"sensitive_values":{}}],"address":"module.artifact_publish"}]}},"resource_drift":[{"address":"module.artifact_publish.google_artifact_registry_repository.repo","module_address":"module.artifact_publish","mode":"managed","type":"google_artifact_registry_repository","name":"repo","provider_name":"registry.terraform.io/hashicorp/google-beta","change":{"actions":["update"],"before":{"cleanup_policies":[{"action":"KEEP","condition":[{"newer_than":"","older_than":"","package_name_prefixes":["webapp","mobile"],"tag_prefixes":["release"],"tag_state":"TAGGED","version_name_prefixes":[]}],"id":"keep-tagged-release","most_recent_versions":[]}],"cleanup_policy_dry_run":false,"create_time":"2024-05-24T11:41:39.113004Z","description":"Publish Artifacts for ML Projects","docker_config":[],"effective_labels":{},"format":"DOCKER","id":"projects/prj-c-bu3artifacts-mj6b/locations/us-central1/repositories/c-publish-artifacts","kms_key_name":"projects/prj-c-kms-exfv/locations/us-central1/keyRings/sample-keyring/cryptoKeys/prj-c-bu3artifacts","labels":null,"location":"us-central1","maven_config":[],"mode":"STANDARD_REPOSITORY","name":"c-publish-artifacts","project":"prj-c-bu3artifacts-mj6b","remote_repository_config":[],"repository_id":"c-publish-artifacts","terraform_labels":{},"timeouts":null,"update_time":"2024-05-24T11:41:39.113004Z","virtual_repository_config":[]},"after":{"cleanup_policies":[{"action":"KEEP","condition":[{"newer_than":"","older_than":"","package_name_prefixes":["webapp","mobile"],"tag_prefixes":["release"],"tag_state":"TAGGED","version_name_prefixes":[]}],"id":"keep-tagged-release","most_recent_versions":[]}],"cleanup_policy_dry_run":false,"create_time":"2024-05-24T11:41:39.113004Z","description":"Publish Artifacts for ML Projects","docker_config":[],"effective_labels":{},"format":"DOCKER","id":"projects/prj-c-bu3artifacts-mj6b/locations/us-central1/repositories/c-publish-artifacts","kms_key_name":"projects/prj-c-kms-exfv/locations/us-central1/keyRings/sample-keyring/cryptoKeys/prj-c-bu3artifacts","labels":{},"location":"us-central1","maven_config":[],"mode":"STANDARD_REPOSITORY","name":"c-publish-artifacts","project":"prj-c-bu3artifacts-mj6b","remote_repository_config":[],"repository_id":"c-publish-artifacts","terraform_labels":{},"timeouts":null,"update_time":"2024-05-24T11:41:39.113004Z","virtual_repository_config":[]},"after_unknown":{},"before_sensitive":{"cleanup_policies":[{"condition":[{"package_name_prefixes":[false,false],"tag_prefixes":[false],"version_name_prefixes":[]}],"most_recent_versions":[]}],"docker_config":[],"effective_labels":{},"maven_config":[],"remote_repository_config":[],"terraform_labels":{},"virtual_repository_config":[]},"after_sensitive":{"cleanup_policies":[{"condition":[{"package_name_prefixes":[false,false],"tag_prefixes":[false],"version_name_prefixes":[]}],"most_recent_versions":[]}],"docker_config":[],"effective_labels":{},"labels":{},"maven_config":[],"remote_repository_config":[],"terraform_labels":{},"virtual_repository_config":[]}}},{"address":"module.artifact_publish.google_artifact_registry_repository_iam_member.project[\"roles/artifactregistry.writer\"]","module_address":"module.artifact_publish","mode":"managed","type":"google_artifact_registry_repository_iam_member","name":"project","index":"roles/artifactregistry.writer","provider_name":"registry.terraform.io/hashicorp/google","change":{"actions":["update"],"before":{"condition":[],"etag":"BwYZMabqeCQ=","id":"projects/prj-c-bu3artifacts-mj6b/locations/us-central1/repositories/c-publish-artifacts/roles/artifactregistry.writer/serviceAccount:393452337890@cloudbuild.gserviceaccount.com","location":"us-central1","member":"serviceAccount:393452337890@cloudbuild.gserviceaccount.com","project":"prj-c-bu3artifacts-mj6b","repository":"projects/prj-c-bu3artifacts-mj6b/locations/us-central1/repositories/c-publish-artifacts","role":"roles/artifactregistry.writer"},"after":{"condition":[],"etag":"BwYZMacjH/I=","id":"projects/prj-c-bu3artifacts-mj6b/locations/us-central1/repositories/c-publish-artifacts/roles/artifactregistry.writer/serviceAccount:393452337890@cloudbuild.gserviceaccount.com","location":"us-central1","member":"serviceAccount:393452337890@cloudbuild.gserviceaccount.com","project":"prj-c-bu3artifacts-mj6b","repository":"projects/prj-c-bu3artifacts-mj6b/locations/us-central1/repositories/c-publish-artifacts","role":"roles/artifactregistry.writer"},"after_unknown":{},"before_sensitive":{"condition":[]},"after_sensitive":{"condition":[]}}},{"address":"module.artifact_publish.google_cloudbuild_trigger.docker_build","module_address":"module.artifact_publish","mode":"managed","type":"google_cloudbuild_trigger","name":"docker_build","provider_name":"registry.terraform.io/hashicorp/google","change":{"actions":["update"],"before":{"approval_config":[{"approval_required":false}],"bitbucket_server_trigger_config":[],"build":[{"artifacts":[],"available_secrets":[],"images":null,"logs_bucket":"","options":[],"queue_ttl":"","secret":[],"source":[],"step":[{"allow_exit_codes":null,"allow_failure":false,"args":["-c","git fetch --unshallow"],"dir":"","entrypoint":"/bin/bash","env":null,"id":"unshallow","name":"gcr.io/cloud-builders/git","script":"","secret_env":null,"timeout":"","timing":"","volumes":[],"wait_for":null},{"allow_exit_codes":null,"allow_failure":false,"args":["-c","changed_files=$(git diff ${COMMIT_SHA}^1 --name-only -r)\nchanged_folders=$(echo \"$changed_files\" | awk -F/ '{print $2}' | sort | uniq )\n\nfor folder in $changed_folders; do\n    echo \"Found docker folder: $folder\"\n    echo $folder \u003e\u003e /workspace/docker_build\ndone\n"],"dir":"","entrypoint":"/bin/bash","env":null,"id":"select-folder","name":"gcr.io/cloud-builders/git","script":"","secret_env":null,"timeout":"","timing":"","volumes":[],"wait_for":null},{"allow_exit_codes":null,"allow_failure":false,"args":["-c","build_path=\"/workspace/docker_build\"\nwhile IFS= read -r line; do\n  docker build -t us-central1-docker.pkg.dev/$PROJECT_ID/c-publish-artifacts/$line images/$line\ndone \u003c \"$build_path\"\n"],"dir":"","entrypoint":"/bin/bash","env":null,"id":"build-image","name":"gcr.io/cloud-builders/docker","script":"","secret_env":null,"timeout":"","timing":"","volumes":[],"wait_for":["select-folder"]},{"allow_exit_codes":null,"allow_failure":false,"args":["-c","build_path=\"/workspace/docker_build\"\nwhile IFS= read -r line; do\n  docker push us-central1-docker.pkg.dev/$PROJECT_ID/c-publish-artifacts/$line\ndone \u003c \"$build_path\"\n"],"dir":"","entrypoint":"/bin/bash","env":null,"id":"push-image","name":"gcr.io/cloud-builders/docker","script":"","secret_env":null,"timeout":"","timing":"","volumes":[],"wait_for":["select-folder","build-image"]}],"substitutions":null,"tags":null,"timeout":"600s"}],"create_time":"2024-05-24T11:41:19.846856052Z","description":"","disabled":false,"filename":"","filter":"","git_file_source":[],"github":[],"id":"projects/prj-c-bu3artifacts-mj6b/locations/us-central1/triggers/7922aa56-a59f-45b8-b739-1fc45980f0e6","ignored_files":null,"include_build_logs":"","included_files":null,"location":"us-central1","name":"docker-build","project":"prj-c-bu3artifacts-mj6b","pubsub_config":[],"repository_event_config":[],"service_account":"","source_to_build":[],"substitutions":null,"tags":null,"timeouts":null,"trigger_id":"7922aa56-a59f-45b8-b739-1fc45980f0e6","trigger_template":[{"branch_name":"^main$","commit_sha":"","dir":"","invert_regex":false,"project_id":"prj-c-bu3artifacts-mj6b","repo_name":"publish-artifacts","tag_name":""}],"webhook_config":[]},"after":{"approval_config":[{"approval_required":false}],"bitbucket_server_trigger_config":[],"build":[{"artifacts":[],"available_secrets":[],"images":[],"logs_bucket":"","options":[],"queue_ttl":"","secret":[],"source":[],"step":[{"allow_exit_codes":[],"allow_failure":false,"args":["-c","git fetch --unshallow"],"dir":"","entrypoint":"/bin/bash","env":[],"id":"unshallow","name":"gcr.io/cloud-builders/git","script":"","secret_env":[],"timeout":"","timing":"","volumes":[],"wait_for":[]},{"allow_exit_codes":[],"allow_failure":false,"args":["-c","changed_files=$(git diff ${COMMIT_SHA}^1 --name-only -r)\nchanged_folders=$(echo \"$changed_files\" | awk -F/ '{print $2}' | sort | uniq )\n\nfor folder in $changed_folders; do\n    echo \"Found docker folder: $folder\"\n    echo $folder \u003e\u003e /workspace/docker_build\ndone\n"],"dir":"","entrypoint":"/bin/bash","env":[],"id":"select-folder","name":"gcr.io/cloud-builders/git","script":"","secret_env":[],"timeout":"","timing":"","volumes":[],"wait_for":[]},{"allow_exit_codes":[],"allow_failure":false,"args":["-c","build_path=\"/workspace/docker_build\"\nwhile IFS= read -r line; do\n  docker build -t us-central1-docker.pkg.dev/$PROJECT_ID/c-publish-artifacts/$line images/$line\ndone \u003c \"$build_path\"\n"],"dir":"","entrypoint":"/bin/bash","env":[],"id":"build-image","name":"gcr.io/cloud-builders/docker","script":"","secret_env":[],"timeout":"","timing":"","volumes":[],"wait_for":["select-folder"]},{"allow_exit_codes":[],"allow_failure":false,"args":["-c","build_path=\"/workspace/docker_build\"\nwhile IFS= read -r line; do\n  docker push us-central1-docker.pkg.dev/$PROJECT_ID/c-publish-artifacts/$line\ndone \u003c \"$build_path\"\n"],"dir":"","entrypoint":"/bin/bash","env":[],"id":"push-image","name":"gcr.io/cloud-builders/docker","script":"","secret_env":[],"timeout":"","timing":"","volumes":[],"wait_for":["select-folder","build-image"]}],"substitutions":{},"tags":[],"timeout":"600s"}],"create_time":"2024-05-24T11:41:19.846856052Z","description":"","disabled":false,"filename":"","filter":"","git_file_source":[],"github":[],"id":"projects/prj-c-bu3artifacts-mj6b/locations/us-central1/triggers/7922aa56-a59f-45b8-b739-1fc45980f0e6","ignored_files":[],"include_build_logs":"","included_files":[],"location":"us-central1","name":"docker-build","project":"prj-c-bu3artifacts-mj6b","pubsub_config":[],"repository_event_config":[],"service_account":"","source_to_build":[],"substitutions":{},"tags":[],"timeouts":null,"trigger_id":"7922aa56-a59f-45b8-b739-1fc45980f0e6","trigger_template":[{"branch_name":"^main$","commit_sha":"","dir":"","invert_regex":false,"project_id":"prj-c-bu3artifacts-mj6b","repo_name":"publish-artifacts","tag_name":""}],"webhook_config":[]},"after_unknown":{},"before_sensitive":{"approval_config":[{}],"bitbucket_server_trigger_config":[],"build":[{"artifacts":[],"available_secrets":[],"options":[],"secret":[],"source":[],"step":[{"args":[false,false],"volumes":[]},{"args":[false,false],"volumes":[]},{"args":[false,false],"volumes":[],"wait_for":[false]},{"args":[false,false],"volumes":[],"wait_for":[false,false]}]}],"git_file_source":[],"github":[],"pubsub_config":[],"repository_event_config":[],"source_to_build":[],"trigger_template":[{}],"webhook_config":[]},"after_sensitive":{"approval_config":[{}],"bitbucket_server_trigger_config":[],"build":[{"artifacts":[],"available_secrets":[],"images":[],"options":[],"secret":[],"source":[],"step":[{"allow_exit_codes":[],"args":[false,false],"env":[],"secret_env":[],"volumes":[],"wait_for":[]},{"allow_exit_codes":[],"args":[false,false],"env":[],"secret_env":[],"volumes":[],"wait_for":[]},{"allow_exit_codes":[],"args":[false,false],"env":[],"secret_env":[],"volumes":[],"wait_for":[false]},{"allow_exit_codes":[],"args":[false,false],"env":[],"secret_env":[],"volumes":[],"wait_for":[false,false]}],"substitutions":{},"tags":[]}],"git_file_source":[],"github":[],"ignored_files":[],"included_files":[],"pubsub_config":[],"repository_event_config":[],"source_to_build":[],"substitutions":{},"tags":[],"trigger_template":[{}],"webhook_config":[]}}}],"resource_changes":[{"address":"module.artifact_publish.google_artifact_registry_repository.repo","module_address":"module.artifact_publish","mode":"managed","type":"google_artifact_registry_repository","name":"repo","provider_name":"registry.terraform.io/hashicorp/google-beta","change":{"actions":["no-op"],"before":{"cleanup_policies":[{"action":"KEEP","condition":[{"newer_than":"","older_than":"","package_name_prefixes":["webapp","mobile"],"tag_prefixes":["release"],"tag_state":"TAGGED","version_name_prefixes":[]}],"id":"keep-tagged-release","most_recent_versions":[]}],"cleanup_policy_dry_run":false,"create_time":"2024-05-24T11:41:39.113004Z","description":"Publish Artifacts for ML Projects","docker_config":[],"effective_labels":{},"format":"DOCKER","id":"projects/prj-c-bu3artifacts-mj6b/locations/us-central1/repositories/c-publish-artifacts","kms_key_name":"projects/prj-c-kms-exfv/locations/us-central1/keyRings/sample-keyring/cryptoKeys/prj-c-bu3artifacts","labels":{},"location":"us-central1","maven_config":[],"mode":"STANDARD_REPOSITORY","name":"c-publish-artifacts","project":"prj-c-bu3artifacts-mj6b","remote_repository_config":[],"repository_id":"c-publish-artifacts","terraform_labels":{},"timeouts":null,"update_time":"2024-05-24T11:41:39.113004Z","virtual_repository_config":[]},"after":{"cleanup_policies":[{"action":"KEEP","condition":[{"newer_than":"","older_than":"","package_name_prefixes":["webapp","mobile"],"tag_prefixes":["release"],"tag_state":"TAGGED","version_name_prefixes":[]}],"id":"keep-tagged-release","most_recent_versions":[]}],"cleanup_policy_dry_run":false,"create_time":"2024-05-24T11:41:39.113004Z","description":"Publish Artifacts for ML Projects","docker_config":[],"effective_labels":{},"format":"DOCKER","id":"projects/prj-c-bu3artifacts-mj6b/locations/us-central1/repositories/c-publish-artifacts","kms_key_name":"projects/prj-c-kms-exfv/locations/us-central1/keyRings/sample-keyring/cryptoKeys/prj-c-bu3artifacts","labels":{},"location":"us-central1","maven_config":[],"mode":"STANDARD_REPOSITORY","name":"c-publish-artifacts","project":"prj-c-bu3artifacts-mj6b","remote_repository_config":[],"repository_id":"c-publish-artifacts","terraform_labels":{},"timeouts":null,"update_time":"2024-05-24T11:41:39.113004Z","virtual_repository_config":[]},"after_unknown":{},"before_sensitive":{"cleanup_policies":[{"condition":[{"package_name_prefixes":[false,false],"tag_prefixes":[false],"version_name_prefixes":[]}],"most_recent_versions":[]}],"docker_config":[],"effective_labels":{},"labels":{},"maven_config":[],"remote_repository_config":[],"terraform_labels":{},"virtual_repository_config":[]},"after_sensitive":{"cleanup_policies":[{"condition":[{"package_name_prefixes":[false,false],"tag_prefixes":[false],"version_name_prefixes":[]}],"most_recent_versions":[]}],"docker_config":[],"effective_labels":{},"labels":{},"maven_config":[],"remote_repository_config":[],"terraform_labels":{},"virtual_repository_config":[]}}},{"address":"module.artifact_publish.google_artifact_registry_repository_iam_member.project[\"roles/artifactregistry.reader\"]","module_address":"module.artifact_publish","mode":"managed","type":"google_artifact_registry_repository_iam_member","name":"project","index":"roles/artifactregistry.reader","provider_name":"registry.terraform.io/hashicorp/google","change":{"actions":["no-op"],"before":{"condition":[],"etag":"BwYZMacjH/I=","id":"projects/prj-c-bu3artifacts-mj6b/locations/us-central1/repositories/c-publish-artifacts/roles/artifactregistry.reader/serviceAccount:393452337890@cloudbuild.gserviceaccount.com","location":"us-central1","member":"serviceAccount:393452337890@cloudbuild.gserviceaccount.com","project":"prj-c-bu3artifacts-mj6b","repository":"projects/prj-c-bu3artifacts-mj6b/locations/us-central1/repositories/c-publish-artifacts","role":"roles/artifactregistry.reader"},"after":{"condition":[],"etag":"BwYZMacjH/I=","id":"projects/prj-c-bu3artifacts-mj6b/locations/us-central1/repositories/c-publish-artifacts/roles/artifactregistry.reader/serviceAccount:393452337890@cloudbuild.gserviceaccount.com","location":"us-central1","member":"serviceAccount:393452337890@cloudbuild.gserviceaccount.com","project":"prj-c-bu3artifacts-mj6b","repository":"projects/prj-c-bu3artifacts-mj6b/locations/us-central1/repositories/c-publish-artifacts","role":"roles/artifactregistry.reader"},"after_unknown":{},"before_sensitive":{"condition":[]},"after_sensitive":{"condition":[]}}},{"address":"module.artifact_publish.google_artifact_registry_repository_iam_member.project[\"roles/artifactregistry.writer\"]","module_address":"module.artifact_publish","mode":"managed","type":"google_artifact_registry_repository_iam_member","name":"project","index":"roles/artifactregistry.writer","provider_name":"registry.terraform.io/hashicorp/google","change":{"actions":["no-op"],"before":{"condition":[],"etag":"BwYZMacjH/I=","id":"projects/prj-c-bu3artifacts-mj6b/locations/us-central1/repositories/c-publish-artifacts/roles/artifactregistry.writer/serviceAccount:393452337890@cloudbuild.gserviceaccount.com","location":"us-central1","member":"serviceAccount:393452337890@cloudbuild.gserviceaccount.com","project":"prj-c-bu3artifacts-mj6b","repository":"projects/prj-c-bu3artifacts-mj6b/locations/us-central1/repositories/c-publish-artifacts","role":"roles/artifactregistry.writer"},"after":{"condition":[],"etag":"BwYZMacjH/I=","id":"projects/prj-c-bu3artifacts-mj6b/locations/us-central1/repositories/c-publish-artifacts/roles/artifactregistry.writer/serviceAccount:393452337890@cloudbuild.gserviceaccount.com","location":"us-central1","member":"serviceAccount:393452337890@cloudbuild.gserviceaccount.com","project":"prj-c-bu3artifacts-mj6b","repository":"projects/prj-c-bu3artifacts-mj6b/locations/us-central1/repositories/c-publish-artifacts","role":"roles/artifactregistry.writer"},"after_unknown":{},"before_sensitive":{"condition":[]},"after_sensitive":{"condition":[]}}},{"address":"module.artifact_publish.google_cloudbuild_trigger.docker_build","module_address":"module.artifact_publish","mode":"managed","type":"google_cloudbuild_trigger","name":"docker_build","provider_name":"registry.terraform.io/hashicorp/google","change":{"actions":["no-op"],"before":{"approval_config":[{"approval_required":false}],"bitbucket_server_trigger_config":[],"build":[{"artifacts":[],"available_secrets":[],"images":[],"logs_bucket":"","options":[],"queue_ttl":"","secret":[],"source":[],"step":[{"allow_exit_codes":[],"allow_failure":false,"args":["-c","git fetch --unshallow"],"dir":"","entrypoint":"/bin/bash","env":[],"id":"unshallow","name":"gcr.io/cloud-builders/git","script":"","secret_env":[],"timeout":"","timing":"","volumes":[],"wait_for":[]},{"allow_exit_codes":[],"allow_failure":false,"args":["-c","changed_files=$(git diff ${COMMIT_SHA}^1 --name-only -r)\nchanged_folders=$(echo \"$changed_files\" | awk -F/ '{print $2}' | sort | uniq )\n\nfor folder in $changed_folders; do\n    echo \"Found docker folder: $folder\"\n    echo $folder \u003e\u003e /workspace/docker_build\ndone\n"],"dir":"","entrypoint":"/bin/bash","env":[],"id":"select-folder","name":"gcr.io/cloud-builders/git","script":"","secret_env":[],"timeout":"","timing":"","volumes":[],"wait_for":[]},{"allow_exit_codes":[],"allow_failure":false,"args":["-c","build_path=\"/workspace/docker_build\"\nwhile IFS= read -r line; do\n  docker build -t us-central1-docker.pkg.dev/$PROJECT_ID/c-publish-artifacts/$line images/$line\ndone \u003c \"$build_path\"\n"],"dir":"","entrypoint":"/bin/bash","env":[],"id":"build-image","name":"gcr.io/cloud-builders/docker","script":"","secret_env":[],"timeout":"","timing":"","volumes":[],"wait_for":["select-folder"]},{"allow_exit_codes":[],"allow_failure":false,"args":["-c","build_path=\"/workspace/docker_build\"\nwhile IFS= read -r line; do\n  docker push us-central1-docker.pkg.dev/$PROJECT_ID/c-publish-artifacts/$line\ndone \u003c \"$build_path\"\n"],"dir":"","entrypoint":"/bin/bash","env":[],"id":"push-image","name":"gcr.io/cloud-builders/docker","script":"","secret_env":[],"timeout":"","timing":"","volumes":[],"wait_for":["select-folder","build-image"]}],"substitutions":{},"tags":[],"timeout":"600s"}],"create_time":"2024-05-24T11:41:19.846856052Z","description":"","disabled":false,"filename":"","filter":"","git_file_source":[],"github":[],"id":"projects/prj-c-bu3artifacts-mj6b/locations/us-central1/triggers/7922aa56-a59f-45b8-b739-1fc45980f0e6","ignored_files":[],"include_build_logs":"","included_files":[],"location":"us-central1","name":"docker-build","project":"prj-c-bu3artifacts-mj6b","pubsub_config":[],"repository_event_config":[],"service_account":"","source_to_build":[],"substitutions":{},"tags":[],"timeouts":null,"trigger_id":"7922aa56-a59f-45b8-b739-1fc45980f0e6","trigger_template":[{"branch_name":"^main$","commit_sha":"","dir":"","invert_regex":false,"project_id":"prj-c-bu3artifacts-mj6b","repo_name":"publish-artifacts","tag_name":""}],"webhook_config":[]},"after":{"approval_config":[{"approval_required":false}],"bitbucket_server_trigger_config":[],"build":[{"artifacts":[],"available_secrets":[],"images":[],"logs_bucket":"","options":[],"queue_ttl":"","secret":[],"source":[],"step":[{"allow_exit_codes":[],"allow_failure":false,"args":["-c","git fetch --unshallow"],"dir":"","entrypoint":"/bin/bash","env":[],"id":"unshallow","name":"gcr.io/cloud-builders/git","script":"","secret_env":[],"timeout":"","timing":"","volumes":[],"wait_for":[]},{"allow_exit_codes":[],"allow_failure":false,"args":["-c","changed_files=$(git diff ${COMMIT_SHA}^1 --name-only -r)\nchanged_folders=$(echo \"$changed_files\" | awk -F/ '{print $2}' | sort | uniq )\n\nfor folder in $changed_folders; do\n    echo \"Found docker folder: $folder\"\n    echo $folder \u003e\u003e /workspace/docker_build\ndone\n"],"dir":"","entrypoint":"/bin/bash","env":[],"id":"select-folder","name":"gcr.io/cloud-builders/git","script":"","secret_env":[],"timeout":"","timing":"","volumes":[],"wait_for":[]},{"allow_exit_codes":[],"allow_failure":false,"args":["-c","build_path=\"/workspace/docker_build\"\nwhile IFS= read -r line; do\n  docker build -t us-central1-docker.pkg.dev/$PROJECT_ID/c-publish-artifacts/$line images/$line\ndone \u003c \"$build_path\"\n"],"dir":"","entrypoint":"/bin/bash","env":[],"id":"build-image","name":"gcr.io/cloud-builders/docker","script":"","secret_env":[],"timeout":"","timing":"","volumes":[],"wait_for":["select-folder"]},{"allow_exit_codes":[],"allow_failure":false,"args":["-c","build_path=\"/workspace/docker_build\"\nwhile IFS= read -r line; do\n  docker push us-central1-docker.pkg.dev/$PROJECT_ID/c-publish-artifacts/$line\ndone \u003c \"$build_path\"\n"],"dir":"","entrypoint":"/bin/bash","env":[],"id":"push-image","name":"gcr.io/cloud-builders/docker","script":"","secret_env":[],"timeout":"","timing":"","volumes":[],"wait_for":["select-folder","build-image"]}],"substitutions":{},"tags":[],"timeout":"600s"}],"create_time":"2024-05-24T11:41:19.846856052Z","description":"","disabled":false,"filename":"","filter":"","git_file_source":[],"github":[],"id":"projects/prj-c-bu3artifacts-mj6b/locations/us-central1/triggers/7922aa56-a59f-45b8-b739-1fc45980f0e6","ignored_files":[],"include_build_logs":"","included_files":[],"location":"us-central1","name":"docker-build","project":"prj-c-bu3artifacts-mj6b","pubsub_config":[],"repository_event_config":[],"service_account":"","source_to_build":[],"substitutions":{},"tags":[],"timeouts":null,"trigger_id":"7922aa56-a59f-45b8-b739-1fc45980f0e6","trigger_template":[{"branch_name":"^main$","commit_sha":"","dir":"","invert_regex":false,"project_id":"prj-c-bu3artifacts-mj6b","repo_name":"publish-artifacts","tag_name":""}],"webhook_config":[]},"after_unknown":{},"before_sensitive":{"approval_config":[{}],"bitbucket_server_trigger_config":[],"build":[{"artifacts":[],"available_secrets":[],"images":[],"options":[],"secret":[],"source":[],"step":[{"allow_exit_codes":[],"args":[false,false],"env":[],"secret_env":[],"volumes":[],"wait_for":[]},{"allow_exit_codes":[],"args":[false,false],"env":[],"secret_env":[],"volumes":[],"wait_for":[]},{"allow_exit_codes":[],"args":[false,false],"env":[],"secret_env":[],"volumes":[],"wait_for":[false]},{"allow_exit_codes":[],"args":[false,false],"env":[],"secret_env":[],"volumes":[],"wait_for":[false,false]}],"substitutions":{},"tags":[]}],"git_file_source":[],"github":[],"ignored_files":[],"included_files":[],"pubsub_config":[],"repository_event_config":[],"source_to_build":[],"substitutions":{},"tags":[],"trigger_template":[{}],"webhook_config":[]},"after_sensitive":{"approval_config":[{}],"bitbucket_server_trigger_config":[],"build":[{"artifacts":[],"available_secrets":[],"images":[],"options":[],"secret":[],"source":[],"step":[{"allow_exit_codes":[],"args":[false,false],"env":[],"secret_env":[],"volumes":[],"wait_for":[]},{"allow_exit_codes":[],"args":[false,false],"env":[],"secret_env":[],"volumes":[],"wait_for":[]},{"allow_exit_codes":[],"args":[false,false],"env":[],"secret_env":[],"volumes":[],"wait_for":[false]},{"allow_exit_codes":[],"args":[false,false],"env":[],"secret_env":[],"volumes":[],"wait_for":[false,false]}],"substitutions":{},"tags":[]}],"git_file_source":[],"github":[],"ignored_files":[],"included_files":[],"pubsub_config":[],"repository_event_config":[],"source_to_build":[],"substitutions":{},"tags":[],"trigger_template":[{}],"webhook_config":[]}}},{"address":"module.artifact_publish.google_kms_crypto_key_iam_member.artifact-kms-key-binding","module_address":"module.artifact_publish","mode":"managed","type":"google_kms_crypto_key_iam_member","name":"artifact-kms-key-binding","provider_name":"registry.terraform.io/hashicorp/google","change":{"actions":["no-op"],"before":{"condition":[],"crypto_key_id":"projects/prj-c-kms-exfv/locations/us-central1/keyRings/sample-keyring/cryptoKeys/prj-c-bu3artifacts","etag":"BwYZMaV6vl4=","id":"projects/prj-c-kms-exfv/locations/us-central1/keyRings/sample-keyring/cryptoKeys/prj-c-bu3artifacts/roles/cloudkms.cryptoKeyEncrypterDecrypter/serviceAccount:service-393452337890@gcp-sa-artifactregistry.iam.gserviceaccount.com","member":"serviceAccount:service-393452337890@gcp-sa-artifactregistry.iam.gserviceaccount.com","role":"roles/cloudkms.cryptoKeyEncrypterDecrypter"},"after":{"condition":[],"crypto_key_id":"projects/prj-c-kms-exfv/locations/us-central1/keyRings/sample-keyring/cryptoKeys/prj-c-bu3artifacts","etag":"BwYZMaV6vl4=","id":"projects/prj-c-kms-exfv/locations/us-central1/keyRings/sample-keyring/cryptoKeys/prj-c-bu3artifacts/roles/cloudkms.cryptoKeyEncrypterDecrypter/serviceAccount:service-393452337890@gcp-sa-artifactregistry.iam.gserviceaccount.com","member":"serviceAccount:service-393452337890@gcp-sa-artifactregistry.iam.gserviceaccount.com","role":"roles/cloudkms.cryptoKeyEncrypterDecrypter"},"after_unknown":{},"before_sensitive":{"condition":[]},"after_sensitive":{"condition":[]}}},{"address":"module.artifact_publish.google_project_service_identity.artifact_registry_agent","module_address":"module.artifact_publish","mode":"managed","type":"google_project_service_identity","name":"artifact_registry_agent","provider_name":"registry.terraform.io/hashicorp/google-beta","change":{"actions":["no-op"],"before":{"email":"service-393452337890@gcp-sa-artifactregistry.iam.gserviceaccount.com","id":"projects/prj-c-bu3artifacts-mj6b/services/artifactregistry.googleapis.com","project":"prj-c-bu3artifacts-mj6b","service":"artifactregistry.googleapis.com","timeouts":null},"after":{"email":"service-393452337890@gcp-sa-artifactregistry.iam.gserviceaccount.com","id":"projects/prj-c-bu3artifacts-mj6b/services/artifactregistry.googleapis.com","project":"prj-c-bu3artifacts-mj6b","service":"artifactregistry.googleapis.com","timeouts":null},"after_unknown":{},"before_sensitive":{},"after_sensitive":{}}}],"output_changes":{"cloudbuild_trigger_id":{"actions":["no-op"],"before":"projects/prj-c-bu3artifacts-mj6b/locations/us-central1/triggers/7922aa56-a59f-45b8-b739-1fc45980f0e6","after":"projects/prj-c-bu3artifacts-mj6b/locations/us-central1/triggers/7922aa56-a59f-45b8-b739-1fc45980f0e6","after_unknown":false,"before_sensitive":false,"after_sensitive":false}},"prior_state":{"format_version":"1.0","terraform_version":"1.8.5","values":{"outputs":{"cloudbuild_trigger_id":{"sensitive":false,"value":"projects/prj-c-bu3artifacts-mj6b/locations/us-central1/triggers/7922aa56-a59f-45b8-b739-1fc45980f0e6","type":"string"}},"root_module":{"resources":[{"address":"data.terraform_remote_state.projects_shared","mode":"data","type":"terraform_remote_state","name":"projects_shared","provider_name":"terraform.io/builtin/terraform","schema_version":0,"values":{"backend":"gcs","config":{"bucket":"bkt-prj-b-seed-7c57-gcp-projects-tfstate","prefix":"terraform/projects/business_unit_3/shared"},"defaults":null,"outputs":{"apply_triggers_id":["projects/prj-c-bu3infra-pipeline-cfi9/triggers/2edc8ebf-11c0-46f2-982d-5f41ebf1ac26","projects/prj-c-bu3infra-pipeline-cfi9/triggers/3c9209f9-199f-4bd2-b429-9f1163fbf53c","projects/prj-c-bu3infra-pipeline-cfi9/triggers/7285ccab-2604-45c9-8980-501cdb1b7e0f"],"artifact_buckets":{"bu3-artifact-publish":"bkt-prj-c-bu3infra-pipeline-cfi9-bu3-artifact-publish-artifacts","bu3-machine-learning":"bkt-prj-c-bu3infra-pipeline-cfi9-bu3-machine-learning-artifacts","bu3-service-catalog":"bkt-prj-c-bu3infra-pipeline-cfi9-bu3-service-catalog-artifacts"},"artifacts_repo_id":"projects/prj-c-bu3artifacts-mj6b/repos/publish-artifacts","artifacts_repo_name":"publish-artifacts","cloudbuild_project_id":"prj-c-bu3infra-pipeline-cfi9","common_artifacts_project_id":"prj-c-bu3artifacts-mj6b","default_region":"us-central1","enable_cloudbuild_deploy":true,"log_buckets":{"bu3-artifact-publish":"bkt-prj-c-bu3infra-pipeline-cfi9-bu3-artifact-publish-logs","bu3-machine-learning":"bkt-prj-c-bu3infra-pipeline-cfi9-bu3-machine-learning-logs","bu3-service-catalog":"bkt-prj-c-bu3infra-pipeline-cfi9-bu3-service-catalog-logs"},"plan_triggers_id":["projects/prj-c-bu3infra-pipeline-cfi9/triggers/392c86e8-d39f-41df-8ffd-e51c6c3c3968","projects/prj-c-bu3infra-pipeline-cfi9/triggers/7ad4f206-94ba-423d-b42d-d3efca276ace","projects/prj-c-bu3infra-pipeline-cfi9/triggers/c9ee42aa-2123-46ad-bb25-70e0e5c3b711"],"repos":["bu3-artifact-publish","bu3-machine-learning","bu3-service-catalog"],"service_catalog_project_id":"prj-c-bu3service-catalog-4x5e","service_catalog_repo_id":"projects/prj-c-bu3service-catalog-4x5e/repos/service-catalog","service_catalog_repo_name":"service-catalog","state_buckets":{"bu3-artifact-publish":"bkt-prj-c-bu3infra-pipeline-cfi9-bu3-artifact-publish-state","bu3-machine-learning":"bkt-prj-c-bu3infra-pipeline-cfi9-bu3-machine-learning-state","bu3-service-catalog":"bkt-prj-c-bu3infra-pipeline-cfi9-bu3-service-catalog-state"},"terraform_service_accounts":{"bu3-artifact-publish":"sa-tf-cb-bu3-artifact-publish@prj-c-bu3infra-pipeline-cfi9.iam.gserviceaccount.com","bu3-machine-learning":"sa-tf-cb-bu3-machine-learning@prj-c-bu3infra-pipeline-cfi9.iam.gserviceaccount.com","bu3-service-catalog":"sa-tf-cb-bu3-service-catalog@prj-c-bu3infra-pipeline-cfi9.iam.gserviceaccount.com"}},"workspace":null},"sensitive_values":{"config":{},"outputs":{"apply_triggers_id":[false,false,false],"artifact_buckets":{},"log_buckets":{},"plan_triggers_id":[false,false,false],"repos":[false,false,false],"state_buckets":{},"terraform_service_accounts":{}}}}],"child_modules":[{"resources":[{"address":"module.artifact_publish.data.google_kms_crypto_key.key","mode":"data","type":"google_kms_crypto_key","name":"key","provider_name":"registry.terraform.io/hashicorp/google","schema_version":0,"values":{"crypto_key_backend":"","destroy_scheduled_duration":"2592000s","effective_labels":{},"id":"projects/prj-c-kms-exfv/locations/us-central1/keyRings/sample-keyring/cryptoKeys/prj-c-bu3artifacts","import_only":false,"key_ring":"projects/prj-c-kms-exfv/locations/us-central1/keyRings/sample-keyring","labels":{},"name":"prj-c-bu3artifacts","primary":[{"name":"projects/prj-c-kms-exfv/locations/us-central1/keyRings/sample-keyring/cryptoKeys/prj-c-bu3artifacts/cryptoKeyVersions/1","state":"ENABLED"}],"purpose":"ENCRYPT_DECRYPT","rotation_period":"7776000s","skip_initial_version_creation":null,"terraform_labels":{},"version_template":[{"algorithm":"GOOGLE_SYMMETRIC_ENCRYPTION","protection_level":"SOFTWARE"}]},"sensitive_values":{"effective_labels":{},"labels":{},"primary":[{}],"terraform_labels":{},"version_template":[{}]}},{"address":"module.artifact_publish.data.google_kms_key_ring.kms","mode":"data","type":"google_kms_key_ring","name":"kms","provider_name":"registry.terraform.io/hashicorp/google","schema_version":0,"values":{"id":"projects/prj-c-kms-exfv/locations/us-central1/keyRings/sample-keyring","location":"us-central1","name":"sample-keyring","project":"prj-c-kms-exfv"},"sensitive_values":{}},{"address":"module.artifact_publish.data.google_project.project","mode":"data","type":"google_project","name":"project","provider_name":"registry.terraform.io/hashicorp/google","schema_version":0,"values":{"auto_create_network":null,"billing_account":null,"effective_labels":{"application_name":"app-infra-artifacts","billing_code":"1234","business_code":"bu3","env_code":"c","environment":"common","primary_contact":"example","secondary_contact":"example2","vpc_type":""},"folder_id":"257579943651","id":"projects/prj-c-bu3artifacts-mj6b","labels":{"application_name":"app-infra-artifacts","billing_code":"1234","business_code":"bu3","env_code":"c","environment":"common","primary_contact":"example","secondary_contact":"example2","vpc_type":""},"name":"prj-c-bu3artifacts","number":"393452337890","org_id":"","project_id":"prj-c-bu3artifacts-mj6b","skip_delete":null,"terraform_labels":{"application_name":"app-infra-artifacts","billing_code":"1234","business_code":"bu3","env_code":"c","environment":"common","primary_contact":"example","secondary_contact":"example2","vpc_type":""}},"sensitive_values":{"effective_labels":{},"labels":{},"terraform_labels":{}}},{"address":"module.artifact_publish.data.google_projects.kms","mode":"data","type":"google_projects","name":"kms","provider_name":"registry.terraform.io/hashicorp/google","schema_version":0,"values":{"filter":"labels.application_name:org-kms labels.environment:production lifecycleState:ACTIVE","id":"labels.application_name:org-kms labels.environment:production lifecycleState:ACTIVE","projects":[{"create_time":"2024-05-23T13:59:32.337Z","labels":{"application_name":"org-kms","billing_code":"1234","business_code":"abcd","env_code":"p","environment":"production","primary_contact":"example1","secondary_contact":"example2"},"lifecycle_state":"ACTIVE","name":"prj-c-kms","number":"882435372779","parent":{"id":"257579943651","type":"folder"},"project_id":"prj-c-kms-exfv"},{"create_time":"2024-05-07T18:02:15.175Z","labels":{"application_name":"org-kms","billing_code":"1234","business_code":"abcd","env_code":"p","environment":"production","primary_contact":"example1","secondary_contact":"example2"},"lifecycle_state":"ACTIVE","name":"prj-c-kms","number":"179638005318","parent":{"id":"916272149312","type":"folder"},"project_id":"prj-c-kms-fqjv"},{"create_time":"2024-04-17T18:22:26.386Z","labels":{"application_name":"org-kms","billing_code":"1234","business_code":"abcd","env_code":"p","environment":"production","primary_contact":"example1","secondary_contact":"example2"},"lifecycle_state":"ACTIVE","name":"prj-c-kms","number":"376975624185","parent":{"id":"610108686835","type":"folder"},"project_id":"prj-c-kms-wj8i"},{"create_time":"2024-04-01T20:07:22.159Z","labels":{"application_name":"org-kms","billing_code":"1234","business_code":"abcd","env_code":"p","environment":"production","primary_contact":"example1","secondary_contact":"example2"},"lifecycle_state":"ACTIVE","name":"ds-c-kms","number":"1028626746541","parent":{"id":"490233981486","type":"folder"},"project_id":"ds-c-kms-2r37"}]},"sensitive_values":{"projects":[{"labels":{},"parent":{}},{"labels":{},"parent":{}},{"labels":{},"parent":{}},{"labels":{},"parent":{}}]}},{"address":"module.artifact_publish.google_artifact_registry_repository.repo","mode":"managed","type":"google_artifact_registry_repository","name":"repo","provider_name":"registry.terraform.io/hashicorp/google-beta","schema_version":0,"values":{"cleanup_policies":[{"action":"KEEP","condition":[{"newer_than":"","older_than":"","package_name_prefixes":["webapp","mobile"],"tag_prefixes":["release"],"tag_state":"TAGGED","version_name_prefixes":[]}],"id":"keep-tagged-release","most_recent_versions":[]}],"cleanup_policy_dry_run":false,"create_time":"2024-05-24T11:41:39.113004Z","description":"Publish Artifacts for ML Projects","docker_config":[],"effective_labels":{},"format":"DOCKER","id":"projects/prj-c-bu3artifacts-mj6b/locations/us-central1/repositories/c-publish-artifacts","kms_key_name":"projects/prj-c-kms-exfv/locations/us-central1/keyRings/sample-keyring/cryptoKeys/prj-c-bu3artifacts","labels":{},"location":"us-central1","maven_config":[],"mode":"STANDARD_REPOSITORY","name":"c-publish-artifacts","project":"prj-c-bu3artifacts-mj6b","remote_repository_config":[],"repository_id":"c-publish-artifacts","terraform_labels":{},"timeouts":null,"update_time":"2024-05-24T11:41:39.113004Z","virtual_repository_config":[]},"sensitive_values":{"cleanup_policies":[{"condition":[{"package_name_prefixes":[false,false],"tag_prefixes":[false],"version_name_prefixes":[]}],"most_recent_versions":[]}],"docker_config":[],"effective_labels":{},"labels":{},"maven_config":[],"remote_repository_config":[],"terraform_labels":{},"virtual_repository_config":[]},"depends_on":["data.terraform_remote_state.projects_shared","module.artifact_publish.data.google_kms_crypto_key.key","module.artifact_publish.data.google_kms_key_ring.kms","module.artifact_publish.data.google_project.project","module.artifact_publish.data.google_projects.kms","module.artifact_publish.google_kms_crypto_key_iam_member.artifact-kms-key-binding","module.artifact_publish.google_project_service_identity.artifact_registry_agent"]},{"address":"module.artifact_publish.google_artifact_registry_repository_iam_member.project[\"roles/artifactregistry.reader\"]","mode":"managed","type":"google_artifact_registry_repository_iam_member","name":"project","index":"roles/artifactregistry.reader","provider_name":"registry.terraform.io/hashicorp/google","schema_version":0,"values":{"condition":[],"etag":"BwYZMacjH/I=","id":"projects/prj-c-bu3artifacts-mj6b/locations/us-central1/repositories/c-publish-artifacts/roles/artifactregistry.reader/serviceAccount:393452337890@cloudbuild.gserviceaccount.com","location":"us-central1","member":"serviceAccount:393452337890@cloudbuild.gserviceaccount.com","project":"prj-c-bu3artifacts-mj6b","repository":"projects/prj-c-bu3artifacts-mj6b/locations/us-central1/repositories/c-publish-artifacts","role":"roles/artifactregistry.reader"},"sensitive_values":{"condition":[]},"depends_on":["data.terraform_remote_state.projects_shared","module.artifact_publish.data.google_kms_crypto_key.key","module.artifact_publish.data.google_kms_key_ring.kms","module.artifact_publish.data.google_project.project","module.artifact_publish.data.google_projects.kms","module.artifact_publish.google_artifact_registry_repository.repo","module.artifact_publish.google_kms_crypto_key_iam_member.artifact-kms-key-binding","module.artifact_publish.google_project_service_identity.artifact_registry_agent"]},{"address":"module.artifact_publish.google_artifact_registry_repository_iam_member.project[\"roles/artifactregistry.writer\"]","mode":"managed","type":"google_artifact_registry_repository_iam_member","name":"project","index":"roles/artifactregistry.writer","provider_name":"registry.terraform.io/hashicorp/google","schema_version":0,"values":{"condition":[],"etag":"BwYZMacjH/I=","id":"projects/prj-c-bu3artifacts-mj6b/locations/us-central1/repositories/c-publish-artifacts/roles/artifactregistry.writer/serviceAccount:393452337890@cloudbuild.gserviceaccount.com","location":"us-central1","member":"serviceAccount:393452337890@cloudbuild.gserviceaccount.com","project":"prj-c-bu3artifacts-mj6b","repository":"projects/prj-c-bu3artifacts-mj6b/locations/us-central1/repositories/c-publish-artifacts","role":"roles/artifactregistry.writer"},"sensitive_values":{"condition":[]},"depends_on":["data.terraform_remote_state.projects_shared","module.artifact_publish.data.google_kms_crypto_key.key","module.artifact_publish.data.google_kms_key_ring.kms","module.artifact_publish.data.google_project.project","module.artifact_publish.data.google_projects.kms","module.artifact_publish.google_artifact_registry_repository.repo","module.artifact_publish.google_kms_crypto_key_iam_member.artifact-kms-key-binding","module.artifact_publish.google_project_service_identity.artifact_registry_agent"]},{"address":"module.artifact_publish.google_cloudbuild_trigger.docker_build","mode":"managed","type":"google_cloudbuild_trigger","name":"docker_build","provider_name":"registry.terraform.io/hashicorp/google","schema_version":2,"values":{"approval_config":[{"approval_required":false}],"bitbucket_server_trigger_config":[],"build":[{"artifacts":[],"available_secrets":[],"images":[],"logs_bucket":"","options":[],"queue_ttl":"","secret":[],"source":[],"step":[{"allow_exit_codes":[],"allow_failure":false,"args":["-c","git fetch --unshallow"],"dir":"","entrypoint":"/bin/bash","env":[],"id":"unshallow","name":"gcr.io/cloud-builders/git","script":"","secret_env":[],"timeout":"","timing":"","volumes":[],"wait_for":[]},{"allow_exit_codes":[],"allow_failure":false,"args":["-c","changed_files=$(git diff ${COMMIT_SHA}^1 --name-only -r)\nchanged_folders=$(echo \"$changed_files\" | awk -F/ '{print $2}' | sort | uniq )\n\nfor folder in $changed_folders; do\n    echo \"Found docker folder: $folder\"\n    echo $folder \u003e\u003e /workspace/docker_build\ndone\n"],"dir":"","entrypoint":"/bin/bash","env":[],"id":"select-folder","name":"gcr.io/cloud-builders/git","script":"","secret_env":[],"timeout":"","timing":"","volumes":[],"wait_for":[]},{"allow_exit_codes":[],"allow_failure":false,"args":["-c","build_path=\"/workspace/docker_build\"\nwhile IFS= read -r line; do\n  docker build -t us-central1-docker.pkg.dev/$PROJECT_ID/c-publish-artifacts/$line images/$line\ndone \u003c \"$build_path\"\n"],"dir":"","entrypoint":"/bin/bash","env":[],"id":"build-image","name":"gcr.io/cloud-builders/docker","script":"","secret_env":[],"timeout":"","timing":"","volumes":[],"wait_for":["select-folder"]},{"allow_exit_codes":[],"allow_failure":false,"args":["-c","build_path=\"/workspace/docker_build\"\nwhile IFS= read -r line; do\n  docker push us-central1-docker.pkg.dev/$PROJECT_ID/c-publish-artifacts/$line\ndone \u003c \"$build_path\"\n"],"dir":"","entrypoint":"/bin/bash","env":[],"id":"push-image","name":"gcr.io/cloud-builders/docker","script":"","secret_env":[],"timeout":"","timing":"","volumes":[],"wait_for":["select-folder","build-image"]}],"substitutions":{},"tags":[],"timeout":"600s"}],"create_time":"2024-05-24T11:41:19.846856052Z","description":"","disabled":false,"filename":"","filter":"","git_file_source":[],"github":[],"id":"projects/prj-c-bu3artifacts-mj6b/locations/us-central1/triggers/7922aa56-a59f-45b8-b739-1fc45980f0e6","ignored_files":[],"include_build_logs":"","included_files":[],"location":"us-central1","name":"docker-build","project":"prj-c-bu3artifacts-mj6b","pubsub_config":[],"repository_event_config":[],"service_account":"","source_to_build":[],"substitutions":{},"tags":[],"timeouts":null,"trigger_id":"7922aa56-a59f-45b8-b739-1fc45980f0e6","trigger_template":[{"branch_name":"^main$","commit_sha":"","dir":"","invert_regex":false,"project_id":"prj-c-bu3artifacts-mj6b","repo_name":"publish-artifacts","tag_name":""}],"webhook_config":[]},"sensitive_values":{"approval_config":[{}],"bitbucket_server_trigger_config":[],"build":[{"artifacts":[],"available_secrets":[],"images":[],"options":[],"secret":[],"source":[],"step":[{"allow_exit_codes":[],"args":[false,false],"env":[],"secret_env":[],"volumes":[],"wait_for":[]},{"allow_exit_codes":[],"args":[false,false],"env":[],"secret_env":[],"volumes":[],"wait_for":[]},{"allow_exit_codes":[],"args":[false,false],"env":[],"secret_env":[],"volumes":[],"wait_for":[false]},{"allow_exit_codes":[],"args":[false,false],"env":[],"secret_env":[],"volumes":[],"wait_for":[false,false]}],"substitutions":{},"tags":[]}],"git_file_source":[],"github":[],"ignored_files":[],"included_files":[],"pubsub_config":[],"repository_event_config":[],"source_to_build":[],"substitutions":{},"tags":[],"trigger_template":[{}],"webhook_config":[]},"depends_on":["data.terraform_remote_state.projects_shared"]},{"address":"module.artifact_publish.google_kms_crypto_key_iam_member.artifact-kms-key-binding","mode":"managed","type":"google_kms_crypto_key_iam_member","name":"artifact-kms-key-binding","provider_name":"registry.terraform.io/hashicorp/google","schema_version":0,"values":{"condition":[],"crypto_key_id":"projects/prj-c-kms-exfv/locations/us-central1/keyRings/sample-keyring/cryptoKeys/prj-c-bu3artifacts","etag":"BwYZMaV6vl4=","id":"projects/prj-c-kms-exfv/locations/us-central1/keyRings/sample-keyring/cryptoKeys/prj-c-bu3artifacts/roles/cloudkms.cryptoKeyEncrypterDecrypter/serviceAccount:service-393452337890@gcp-sa-artifactregistry.iam.gserviceaccount.com","member":"serviceAccount:service-393452337890@gcp-sa-artifactregistry.iam.gserviceaccount.com","role":"roles/cloudkms.cryptoKeyEncrypterDecrypter"},"sensitive_values":{"condition":[]},"depends_on":["data.terraform_remote_state.projects_shared","module.artifact_publish.data.google_kms_crypto_key.key","module.artifact_publish.data.google_kms_key_ring.kms","module.artifact_publish.data.google_project.project","module.artifact_publish.data.google_projects.kms","module.artifact_publish.google_project_service_identity.artifact_registry_agent"]},{"address":"module.artifact_publish.google_project_service_identity.artifact_registry_agent","mode":"managed","type":"google_project_service_identity","name":"artifact_registry_agent","provider_name":"registry.terraform.io/hashicorp/google-beta","schema_version":0,"values":{"email":"service-393452337890@gcp-sa-artifactregistry.iam.gserviceaccount.com","id":"projects/prj-c-bu3artifacts-mj6b/services/artifactregistry.googleapis.com","project":"prj-c-bu3artifacts-mj6b","service":"artifactregistry.googleapis.com","timeouts":null},"sensitive_values":{},"depends_on":["data.terraform_remote_state.projects_shared"]}],"address":"module.artifact_publish"}]}}},"configuration":{"provider_config":{"google":{"name":"google","full_name":"registry.terraform.io/hashicorp/google","version_constraint":"\u003e= 3.77.0, \u003c 6.0.0"},"google-beta":{"name":"google-beta","full_name":"registry.terraform.io/hashicorp/google-beta","version_constraint":"\u003e= 3.77.0, \u003c 6.0.0"},"null":{"name":"null","full_name":"registry.terraform.io/hashicorp/null","version_constraint":"~\u003e 3.0"},"random":{"name":"random","full_name":"registry.terraform.io/hashicorp/random","version_constraint":"~\u003e 3.1"},"terraform":{"name":"terraform","full_name":"terraform.io/builtin/terraform"}},"root_module":{"outputs":{"cloudbuild_trigger_id":{"expression":{"references":["module.artifact_publish.cloudbuild_trigger_id","module.artifact_publish"]}}},"resources":[{"address":"data.terraform_remote_state.projects_shared","mode":"data","type":"terraform_remote_state","name":"projects_shared","provider_config_key":"terraform","expressions":{"backend":{"constant_value":"gcs"},"config":{"references":["var.remote_state_bucket","local.business_unit"]}},"schema_version":0}],"module_calls":{"artifact_publish":{"source":"../../../../modules/publish_artifacts","expressions":{"cleanup_policies":{"constant_value":[{"action":"KEEP","condition":[{"package_name_prefixes":["webapp","mobile"],"tag_prefixes":["release"],"tag_state":"TAGGED"}],"id":"keep-tagged-release"}]},"description":{"constant_value":"Publish Artifacts for ML Projects"},"environment":{"references":["local.environment"]},"format":{"constant_value":"DOCKER"},"name":{"references":["local.artifacts_repo_name"]},"project_id":{"references":["local.common_artifacts_project_id"]},"region":{"references":["var.instance_region"]}},"module":{"outputs":{"cloudbuild_trigger_id":{"expression":{"references":["google_cloudbuild_trigger.docker_build.id","google_cloudbuild_trigger.docker_build"]}}},"resources":[{"address":"google_artifact_registry_repository.repo","mode":"managed","type":"google_artifact_registry_repository","name":"repo","provider_config_key":"google-beta","expressions":{"cleanup_policy_dry_run":{"references":["var.cleanup_policy_dry_run"]},"description":{"references":["var.description"]},"format":{"references":["var.format"]},"kms_key_name":{"references":["data.google_kms_crypto_key.key.id","data.google_kms_crypto_key.key"]},"location":{"references":["var.region"]},"project":{"references":["data.google_project.project.project_id","data.google_project.project"]},"repository_id":{"references":["local.name_var"]}},"schema_version":0,"depends_on":["google_kms_crypto_key_iam_member.artifact-kms-key-binding"]},{"address":"google_artifact_registry_repository_iam_member.project","mode":"managed","type":"google_artifact_registry_repository_iam_member","name":"project","provider_config_key":"google","expressions":{"location":{"references":["var.region"]},"member":{"references":["data.google_project.project.number","data.google_project.project"]},"project":{"references":["var.project_id"]},"repository":{"references":["google_artifact_registry_repository.repo.repository_id","google_artifact_registry_repository.repo"]},"role":{"references":["each.key"]}},"schema_version":0,"for_each_expression":{"references":["local.trigger_sa_roles"]}},{"address":"google_cloudbuild_trigger.docker_build","mode":"managed","type":"google_cloudbuild_trigger","name":"docker_build","provider_config_key":"google","expressions":{"build":[{"step":[{"args":{"constant_value":["-c","git fetch --unshallow"]},"entrypoint":{"constant_value":"/bin/bash"},"id":{"constant_value":"unshallow"},"name":{"constant_value":"gcr.io/cloud-builders/git"}},{"args":{"constant_value":["-c","changed_files=$(git diff ${COMMIT_SHA}^1 --name-only -r)\nchanged_folders=$(echo \"$changed_files\" | awk -F/ '{print $2}' | sort | uniq )\n\nfor folder in $changed_folders; do\n    echo \"Found docker folder: $folder\"\n    echo $folder \u003e\u003e /workspace/docker_build\ndone\n"]},"entrypoint":{"constant_value":"/bin/bash"},"id":{"constant_value":"select-folder"},"name":{"constant_value":"gcr.io/cloud-builders/git"}},{"args":{"references":["var.region"]},"entrypoint":{"constant_value":"/bin/bash"},"id":{"constant_value":"build-image"},"name":{"constant_value":"gcr.io/cloud-builders/docker"},"wait_for":{"constant_value":["select-folder"]}},{"args":{"references":["var.region"]},"entrypoint":{"constant_value":"/bin/bash"},"id":{"constant_value":"push-image"},"name":{"constant_value":"gcr.io/cloud-builders/docker"},"wait_for":{"constant_value":["select-folder","build-image"]}}]}],"location":{"references":["var.region"]},"name":{"constant_value":"docker-build"},"project":{"references":["var.project_id"]},"trigger_template":[{"branch_name":{"constant_value":"^main$"},"repo_name":{"references":["var.name"]}}]},"schema_version":2},{"address":"google_kms_crypto_key_iam_member.artifact-kms-key-binding","mode":"managed","type":"google_kms_crypto_key_iam_member","name":"artifact-kms-key-binding","provider_config_key":"google","expressions":{"crypto_key_id":{"references":["data.google_kms_crypto_key.key.id","data.google_kms_crypto_key.key"]},"member":{"references":["google_project_service_identity.artifact_registry_agent.email","google_project_service_identity.artifact_registry_agent"]},"role":{"constant_value":"roles/cloudkms.cryptoKeyEncrypterDecrypter"}},"schema_version":0},{"address":"google_project_service_identity.artifact_registry_agent","mode":"managed","type":"google_project_service_identity","name":"artifact_registry_agent","provider_config_key":"google-beta","expressions":{"project":{"references":["var.project_id"]},"service":{"constant_value":"artifactregistry.googleapis.com"}},"schema_version":0},{"address":"data.google_kms_crypto_key.key","mode":"data","type":"google_kms_crypto_key","name":"key","provider_config_key":"google","expressions":{"key_ring":{"references":["data.google_kms_key_ring.kms.id","data.google_kms_key_ring.kms"]},"name":{"references":["data.google_project.project.name","data.google_project.project"]}},"schema_version":0},{"address":"data.google_kms_key_ring.kms","mode":"data","type":"google_kms_key_ring","name":"kms","provider_config_key":"google","expressions":{"location":{"references":["var.region"]},"name":{"constant_value":"sample-keyring"},"project":{"references":["data.google_projects.kms.projects[0].project_id","data.google_projects.kms.projects[0]","data.google_projects.kms.projects","data.google_projects.kms"]}},"schema_version":0},{"address":"data.google_project.project","mode":"data","type":"google_project","name":"project","provider_config_key":"google","expressions":{"project_id":{"references":["var.project_id"]}},"schema_version":0},{"address":"data.google_projects.kms","mode":"data","type":"google_projects","name":"kms","provider_config_key":"google","expressions":{"filter":{"constant_value":"labels.application_name:org-kms labels.environment:production lifecycleState:ACTIVE"}},"schema_version":0}],"variables":{"cleanup_policies":{"description":"List of cleanup policies."},"cleanup_policy_dry_run":{"default":false,"description":"Whether to perform a dry run of the cleanup policy."},"description":{"description":"Description of the repository."},"environment":{"description":"development | staging | production | commmon"},"format":{"description":"Format of the repository."},"name":{"description":"Name of the repository."},"project_id":{"description":"Project ID"},"region":{"description":"Location of the repository."}}}}},"variables":{"instance_region":{"description":"The region where compute instance will be created. A subnetwork must exists in the instance region."},"remote_state_bucket":{"description":"Backend bucket to load remote state information from previous steps."}}}},"relevant_attributes":[{"resource":"module.artifact_publish.google_cloudbuild_trigger.docker_build","attribute":["id"]}],"checks":[{"address":{"kind":"var","module":"module.artifact_publish","name":"environment","to_display":"module.artifact_publish.var.environment"},"status":"pass","instances":[{"address":{"module":"module.artifact_publish","to_display":"module.artifact_publish.var.environment"},"status":"pass"}]}],"timestamp":"2024-06-10T22:17:21Z","applyable":false,"complete":true,"errored":false}
